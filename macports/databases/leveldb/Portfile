PortSystem      1.0

name            leveldb
version         1.7.0
license         BSD
maintainers     openmaintainer
platforms       darwin

description     A fast and lightweight key/value database library by Google.
long_description \
   LevelDB is a fast key-value storage library written at Google \
   that provides an ordered mapping from string keys to string values.

homepage        http://code.google.com/p/leveldb/
master_sites    googlecode

checksums \
    md5     5c3c6cfbb16a21cdbea0db656aa32fec \
    rmd160  3f74de6abbdfd87f7e62584ea0f39dbf5c8b9868 \
    sha256  ddce9a31f51d147158105240468cf1e598ff7f8f32f20eea14847bc13b7edd2e

set major_version [lindex [split ${version} .] 0]
set minor_version [lindex [split ${version} .] 1]

depends_lib     port:snappy

configure {}

test.run        yes
test.target     check

destroot {
    # install headers
    set incdestroot ${destroot}${prefix}/include/leveldb
    xinstall -m 0755 -d ${incdestroot}
    eval xinstall -m 0644 \
        [glob ${worksrcpath}/include/leveldb/*.h] \
        ${incdestroot}

    #install libraries
    set libdestroot ${destroot}${prefix}/lib
    xinstall -m 0755 -d ${libdestroot}
    xinstall -m 0644 \
        ${worksrcpath}/libleveldb.a \
        ${libdestroot}
    xinstall -m 0755 \
        ${worksrcpath}/libleveldb.dylib.${major_version}.${minor_version} \
        ${libdestroot}/libleveldb.${major_version}.${minor_version}.dylib
    system "cd ${libdestroot} && ln -f -s \
        libleveldb.${major_version}.${minor_version}.dylib \
        libleveldb.${major_version}.dylib"
    system "cd ${libdestroot} && ln -f -s \
        libleveldb.${major_version}.${minor_version}.dylib \
        libleveldb.dylib"
    system "install_name_tool \
        -id ${prefix}/lib/libleveldb.${major_version}.dylib \
        ${libdestroot}/libleveldb.${major_version}.dylib"

    # install documents
    set docdestroot ${destroot}${prefix}/share/doc/${name}
    xinstall -m 0755 -d ${docdestroot}/doc
    xinstall -m 0644 -W ${worksrcpath} \
        AUTHORS LICENSE NEWS README TODO \
        ${docdestroot}
    xinstall -m 0644 -W ${worksrcpath}/doc \
        benchmark.html doc.css impl.html index.html \
        log_format.txt table_format.txt \
        ${docdestroot}/doc
}

livecheck.type  regex
livecheck.url   http://code.google.com/p/leveldb/downloads/list
livecheck.regex {leveldb-([0-9]+\.[0-9]+\.[0-9]+)\.}

# Local Variables:
# coding: utf-8
# mode: tcl
# tab-width: 4
# indent-tabs-mode: nil
# c-basic-offset: 4
# End:
# vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
