PortSystem      1.0

name            leveldb
version         1.9.0
license         BSD
maintainers     openmaintainer
platforms       darwin

description     A fast and lightweight key/value database library by Google.
long_description \
   LevelDB is a fast key-value storage library written at Google \
   that provides an ordered mapping from string keys to string values.

homepage        http://code.google.com/p/leveldb/
master_sites    googlecode

checksums \
    md5     12f11385cb58ae0de66d4bc2cc7f8194 \
    rmd160  6d36b6b095c131aeb24fc75ecee8a7b9b4c5ce9e \
    sha256  b2699b04e5aba8e98382c4955b94725d1f76bd0b5decd60c5628205b717a1d4f

set version_array [split ${version} .]
set major_version [lindex ${version_array} 0]
set minor_version [lindex ${version_array} 1]
set tiny_version  [lindex ${version_array} 2]

depends_lib     port:snappy

patchfiles      patch-Makefile.diff \
                patch-build_detect_platform.diff

patch.pre_args  -p0

use_configure   no

build.env       INSTALL_PATH="${prefix}/lib" \
                SHARED_MAJOR="${major_version}" \
                SHARED_MINOR="${minor_version}" \
                SHARED_TINY="${tiny_version}"

test.run        yes
test.target     check

destroot {
    # install headers
    set incdestroot ${destroot}${prefix}/include/leveldb
    xinstall -m 0755 -d ${incdestroot}
    eval xinstall -m 0644 \
        [glob ${worksrcpath}/include/leveldb/*.h] \
        ${incdestroot}

    #install libraries
    set libdestroot ${destroot}${prefix}/lib
    xinstall -m 0755 -d ${libdestroot}
    foreach f [glob ${worksrcpath}/libleveldb.*] {
        file copy ${f} ${libdestroot}
    }

    # install documents
    set docdestroot ${destroot}${prefix}/share/doc/${name}
    xinstall -m 0755 -d ${docdestroot}/doc
    xinstall -m 0644 -W ${worksrcpath} \
        AUTHORS LICENSE NEWS README TODO \
        ${docdestroot}
    xinstall -m 0644 -W ${worksrcpath}/doc \
        benchmark.html doc.css impl.html index.html \
        log_format.txt table_format.txt \
        ${docdestroot}/doc
}

livecheck.type  regex
livecheck.url   http://code.google.com/p/leveldb/downloads/list
livecheck.regex {leveldb-([0-9]+\.[0-9]+\.[0-9]+)\.}

# Local Variables:
# coding: utf-8
# mode: tcl
# tab-width: 4
# indent-tabs-mode: nil
# c-basic-offset: 4
# End:
# vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
