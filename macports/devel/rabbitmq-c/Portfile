PortSystem      1.0

name            rabbitmq-c
version         0.2
revision        0
license         MIT
maintainers     openmaintainer
platforms       darwin

set git_user        alanxz
set git_tag         0.2
set git_hash        f8f4fc7
set git_suffix      0-g03654fa

set codegen_name    rabbitmq-codegen
set codegen_user    rabbitmq
set codegen_tag     rabbitmq_v2_8_7
set codegen_hash    4e97f73
set codegen_suffix  0-g4e97f73

description     RabbitMQ C client
long_description \
   This is a C-language AMQP client library for use \
   with AMQP servers speaking protocol versions 0-9-1.

homepage        http://alanxz.github.com/rabbitmq-c/
master_sites  \
    https://github.com/${git_user}/${name}/zipball/${git_tag}:librabbitmq \
    https://github.com/${codegen_user}/${codegen_name}/zipball/${codegen_tag}:codegen

worksrcdir      ${git_user}-${name}-${git_hash}

use_zip         yes
distfiles \
    ${git_user}-${name}-${git_tag}-${git_suffix}.zip:librabbitmq \
    ${codegen_user}-${codegen_name}-${codegen_tag}-${codegen_suffix}.zip:codegen

checksums \
    ${git_user}-${name}-${version}-${git_suffix}.zip \
        md5    3f1f733f9dfe3e8b6a87b6d3a11aa066 \
        rmd160 a2ae291fca88aeab87e368fa8954fab564e54f59 \
        sha256 df957989f0a6ff51ad219b38fca40364f9a5f8a38798b671d1b7363d82747a4a \
    ${codegen_user}-${codegen_name}-${codegen_tag}-${codegen_suffix}.zip \
        md5    23ba03b307e0e2e002df5e8511d5111f \
        rmd160 3e0eb33c58ee88cd7449662c935ac98f1b5c7fa2 \
        sha256 2d136abc6041aea20d408d0f6ccb7638bb83fc16edc1269c7b6439292a9ce22c

configure.args  --without-popt --without-xmlto

depends_build   port:autoconf port:automake port:libtool

variant tools description {Install RabbitMQ C Client Tools} {
    configure.args-delete   --without-popt --without-xmlto
    configure.args-append   --with-popt --with-xmlto=check
    depends_build-append    port:xmlto
    depends_lib-append      port:popt
}

post-extract {
    file rename \
        ${workpath}/${codegen_user}-${codegen_name}-${codegen_hash} \
        ${worksrcpath}/codegen
}

pre-configure {
     system "cd ${worksrcpath} && ${prefix}/bin/autoreconf -i"
}

livecheck.type  regex
livecheck.url   https://github.com/${git_user}/rabbitmq-c/tags
livecheck.regex {([0-9]+\.[0-9.]+)\.zip}

# Local variables:
# coding: utf-8
# mode: tcl
# tab-width: 4
# indent-tabs-mode: nil
# c-basic-offset: 4
# End:
# vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
