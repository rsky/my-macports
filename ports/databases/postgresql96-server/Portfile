# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem 1.0

name			postgresql96-server
version			9.6:wq.99
categories		databases
platforms		darwin
maintainers		mww jwa
license			Permissive
description		run postgresql96 as server
long_description	${description} (without creating any user)
distfiles

supported_archs		noarch

homepage		http://www.postgresql.org/
master_sites		postgresql

dist_subdir		postgresql96
depends_run		port:postgresql96

use_configure	no
build	{}

set libdir		${prefix}/lib/postgresql96
set dbprefix		${prefix}/var/db/postgresql96
set dbdir		${dbprefix}/defaultdb
set logdir		${prefix}/var/log/postgresql96
set dbuser		_postgres
set dbgrp		_postgres

startupitem.create	yes
startupitem.init  \
	"PGCTL=${libdir}/bin/pg_ctl"
startupitem.start   \
	"sudo -u ${dbuser} \${PGCTL} -D \${POSTGRESQL96DATA:=${dbdir}} start -l ${logdir}/postgres.log"
startupitem.stop    \
	"sudo -u ${dbuser} \${PGCTL} -D \${POSTGRESQL96DATA:=${dbdir}} stop -s -m fast"

destroot {
	xinstall -m 755 -o ${dbuser} -g ${dbgrp} -d \
		${destroot}${dbprefix} \
		${destroot}${logdir}

	destroot.keepdirs-append \
		${destroot}${dbprefix} \
		${destroot}${logdir}
}

notes "\nTo create a database instance, after install do\n\
		sudo mkdir -p -m 0700 ${dbdir}\n\
		sudo chown ${dbuser}:${dbgrp} ${dbdir}\n\
		sudo -u ${dbuser} ${libdir}/bin/initdb -D ${dbdir}"

livecheck.type	none
