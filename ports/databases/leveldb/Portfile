# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem      1.0
PortGroup       github 1.0

name            leveldb
categories      databases
version         1.18
license         BSD
maintainers     openmaintainer
platforms       darwin

github.setup    google ${name} ${version} v

description     A fast and lightweight key/value database library by Google.
long_description \
    LevelDB is a fast key-value storage library written at Google \
    that provides an ordered mapping from string keys to string values.

checksums \
    rmd160  2431505d7d1a08a88b1d10068e571a49dd43a3a0 \
    sha256  007b554b52fb72877bd0a31c078a9ff67b8a9b8e0f55ff641b77783cfd030a4c

set version_array [split ${version} .]
set major_version [lindex ${version_array} 0]
set minor_version [lindex ${version_array} 1]
set tiny_version  0

depends_lib     port:snappy

patchfiles      patch-Makefile.diff \
                patch-build_detect_platform.diff

patch.pre_args  -p0

use_configure   no

build.env       INSTALL_PATH="${prefix}/lib" \
                SHARED_MAJOR="${major_version}" \
                SHARED_MINOR="${minor_version}" \
                SHARED_TINY="${tiny_version}"

test.run        yes
test.target     check

destroot {
    # install headers
    set incdestroot ${destroot}${prefix}/include/leveldb
    xinstall -m 0755 -d ${incdestroot}
    eval xinstall -m 0644 \
        [glob ${worksrcpath}/include/leveldb/*.h] \
        ${incdestroot}

    #install libraries
    set libdestroot ${destroot}${prefix}/lib
    xinstall -m 0755 -d ${libdestroot}
    foreach f [glob ${worksrcpath}/libleveldb.*] {
        file copy ${f} ${libdestroot}
    }

    # install documents
    set docdestroot ${destroot}${prefix}/share/doc/${name}
    xinstall -m 0755 -d ${docdestroot}/doc
    xinstall -m 0644 -W ${worksrcpath} \
        AUTHORS LICENSE NEWS README TODO \
        ${docdestroot}
    xinstall -m 0644 -W ${worksrcpath}/doc \
        benchmark.html doc.css impl.html index.html \
        log_format.txt table_format.txt \
        ${docdestroot}/doc
}
