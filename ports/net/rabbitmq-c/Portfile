# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem      1.0
PortGroup       cmake 1.0

name            rabbitmq-c
categories      net devel
version         0.5.0
revision        0
license         MIT
maintainers     openmaintainer
platforms       darwin

set git_user    alanxz

description     RabbitMQ C client
long_description \
   This is a C-language AMQP client library for use \
   with AMQP servers speaking protocol versions 0-9-1.

homepage        http://alanxz.github.io/rabbitmq-c/
master_sites    https://github.com/${git_user}/${name}/releases/download/v${version}/

checksums \
    rmd160  96106cf9ec09a1b3c7ed87d396dc8357bff71039 \
    sha256  53702ea2ab809af0f923e387458e2cad191d9549f50410035fe82ce5e6ccc4fa

configure.args  -DBUILD_STATIC_LIBS:BOOL=ON \
                -DBUILD_TOOLS:BOOL=OFF \
                -DBUILD_TOOLS_DOCS:BOOL=OFF

variant tools description {Install RabbitMQ C Client Tools} {
    configure.args-delete   -DBUILD_TOOLS:BOOL=OFF
    #                        -DBUILD_TOOLS_DOCS:BOOL=OFF
    configure.args-append   -DBUILD_TOOLS:BOOL=ON
    #                        -DBUILD_TOOLS_DOCS:BOOL=ON
    #depends_build-append    port:xmlto
    depends_lib-append      port:popt
}

pre-configure {
    if {[file exists ${prefix}/include/amqp.h]} {
        ui_error "${name} cannot be built while ${name} is active."
        ui_error "Please deactivate ${name} and try again."
        return -code error "${name} is installed"
    }
}

livecheck.type  regex
livecheck.url   https://github.com/${git_user}/${name}/releases
livecheck.regex {rabbitmq-c v([0-9]+\.[0-9.]+)}
